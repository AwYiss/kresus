// Generated by CoffeeScript 1.7.1
var BankCategory;

BankCategory = require('../models/bankcategory');

module.exports.index = function(req, res) {
  BankCategory.all(function(err, cats) {
    if (err != null) {
      console.error('when retrieving categories:' + err.toString());
      res.send(500, {
        error: 'Server error while retrieving categories'
      });
      return;
    }
    return res.send(200, cats);
  });
  return true;
};

module.exports.create = function(req, res) {
  var cat, _create;
  cat = req.body;
  if (cat.title == null) {
    res.send(400, {
      error: 'Missing title in category'
    });
    return;
  }
  _create = function(cat) {
    return BankCategory.create(cat, function(err, ccat) {
      if (err != null) {
        console.error('when creating category: ' + err.toString());
        res.send(500, 'Server error when creating category');
        return;
      }
      return res.send(200, ccat);
    });
  };
  if (cat.parentId != null) {
    BankCategory.byId(cat.parentId, (function(_this) {
      return function(err, found) {
        if (err != null) {
          console.error('when retrieving parent category: ' + err.toString());
          res.send(500, {
            error: 'Server error when retrieving categories'
          });
          return;
        }
        if (found == null) {
          res.send(404, {
            error: 'Parent category not found'
          });
          return;
        }
        return _create(cat);
      };
    })(this));
    return;
  }
  _create(cat);
  return true;
};
